#!/usr/bin/env bash

set -euo pipefail

ANSI_RED="\033[1;31m"
ANSI_RESET="\033[0m"

function display_error() {
  echo >&2
  # We have to ANSI wrap each line separately to prevent breakage if line prefixes are added
  # later (such as when the builder is untrusted, or when Git adds the "remote:" prefix).
  while IFS= read -r line; do
    echo -e "${ANSI_RED}${line}${ANSI_RESET}" >&2
  done <<< "${1}"
  echo >&2
}

display_error "$(cat <<'EOF'
#######################################################################

WARNING: This builder image (heroku/buildpacks:20) is deprecated,
since it uses legacy shimmed classic Heroku buildpacks, rather than
Heroku's next-generation Cloud Native Buildpacks.

As such, this image is no longer supported and will soon stop receiving
security updates.

Please switch to one of our newer 'heroku/builder:*' builder images,
such as 'heroku/builder:22':
https://github.com/heroku/cnb-builder-images#available-images

If you are using the Pack CLI, you will need to adjust your '--builder'
CLI argument, or else change the default builder configuration using:
'pack config default-builder <new_builder_name>'

If you are using a third-party platform to deploy your app, check their
documentation for how to adjust the builder image used for your build.

#######################################################################
EOF
)"

exit 0
